name: 'Shipi18n Auto Translate'
description: 'Automatically translate your i18n locale files using Shipi18n API'
author: 'Shipi18n'
branding:
  icon: 'globe'
  color: 'blue'

inputs:
  api-key:
    description: 'Shipi18n API key'
    required: true
  source-file:
    description: 'Path to source locale file (e.g., locales/en.json). Use this OR source-dir.'
    required: false
    default: ''
  source-dir:
    description: 'Path to source locale directory (e.g., locales/en). All JSON/YAML files will be translated. Use this OR source-file.'
    required: false
    default: ''
  target-languages:
    description: 'Comma-separated list of target language codes (e.g., es,fr,de)'
    required: true
  output-dir:
    description: 'Directory to output translated files (default: same as source file directory)'
    required: false
    default: ''
  source-language:
    description: 'Source language code (default: en)'
    required: false
    default: 'en'
  create-pr:
    description: 'Create a pull request instead of direct commit (true/false)'
    required: false
    default: 'false'
  incremental:
    description: 'Only translate changed keys (compares with previous git commit)'
    required: false
    default: 'true'
  commit-message:
    description: 'Custom commit message (default: "chore: update translations [skip ci]")'
    required: false
    default: 'chore: update translations [skip ci]'
  branch-name:
    description: 'Branch name for PR (only used if create-pr is true)'
    required: false
    default: 'shipi18n-translations'
  github-token:
    description: 'GitHub token for creating PRs (defaults to GITHUB_TOKEN)'
    required: false
    default: ''
  verify:
    description: 'Enable LLM-based translation verification (true/false). Uses Claude Haiku 4.5 to check meaning, placeholders, and quality.'
    required: false
    default: 'false'
  verify-mode:
    description: 'Verification mode: "quick" (10% sample, fast) or "thorough" (100%, comprehensive)'
    required: false
    default: 'quick'
  self-correct:
    description: 'Enable self-correcting translations (true/false). Automatically retries failed translations with LLM feedback.'
    required: false
    default: 'false'
  max-retries:
    description: 'Maximum retry attempts for self-correcting mode (default: 2, max: 5)'
    required: false
    default: '2'
  skip-keys:
    description: 'Comma-separated keys to skip from translation (exact paths, e.g., brandName,company.name)'
    required: false
    default: ''
  skip-paths:
    description: 'Comma-separated glob patterns to skip (e.g., states.*,config.*.secret)'
    required: false
    default: ''

outputs:
  files-changed:
    description: 'Number of translation files updated'
  files-list:
    description: 'JSON array of files that were translated'
  languages:
    description: 'List of languages translated'
  verification-errors:
    description: 'Number of verification errors found (missing placeholders, missing keys)'
  verification-warnings:
    description: 'Number of verification warnings found (unusual length ratios)'
  llm-verification-pass:
    description: 'Whether LLM verification passed (true/false/skipped)'
  llm-verification-issues:
    description: 'JSON array of LLM verification issues found'
  llm-verification-cost:
    description: 'Total cost of LLM verification in USD (e.g., "0.000123")'
  llm-verification-tokens:
    description: 'Total tokens used for LLM verification (input + output)'
  self-correct-corrected:
    description: 'Number of translations that were auto-corrected'
  self-correct-needs-review:
    description: 'Number of translations flagged for human review'
  self-correct-cost:
    description: 'Total cost of self-correcting in USD'
  skipped-keys-count:
    description: 'Number of keys skipped from translation'

runs:
  using: 'node20'
  main: 'dist/index.js'
